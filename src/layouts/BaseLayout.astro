---
import "../styles/global.css";

const {
  title = "Synthetic Audience Lab",
  description = "Simula cómo reacciona tu público antes de gastar en anuncios.",
} = Astro.props;
---

<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{title}</title>
    <meta name="description" content={description} />
  </head>

  <body class="min-h-screen bg-[#1a1b20] text-zinc-100 antialiased scroll-smooth">
    <slot />

    <!-- Animaciones on-scroll -->
    <script is:inline>
      (() => {
        const onReady = () => {
          const targets = document.querySelectorAll(".sal-animate-fade-up");
          if (!targets.length) return;

          const observer = new IntersectionObserver(
            (entries) => {
              for (const entry of entries) {
                const el = entry.target;
                if (entry.isIntersecting) el.classList.add("is-visible");
                else el.classList.remove("is-visible");
              }
            },
            { threshold: 0.18 }
          );

          targets.forEach((el) => observer.observe(el));
        };

        if (document.readyState === "loading") {
          document.addEventListener("DOMContentLoaded", onReady);
        } else {
          onReady();
        }
      })();
    </script>

    <!-- Cal.com embed (modal dentro de tu web) -->
    <script is:inline>
      (function (C, A, L) {
        let p = function (a, ar) {
          a.q.push(ar);
        };
        let d = C.document;
        C.Cal =
          C.Cal ||
          function () {
            let cal = C.Cal;
            let ar = arguments;
            if (!cal.loaded) {
              cal.ns = {};
              cal.q = cal.q || [];
              d.head.appendChild(d.createElement("script")).src = A;
              cal.loaded = true;
            }
            if (ar[0] === L) {
              const api = function () {
                p(api, arguments);
              };
              const namespace = ar[1];
              api.q = api.q || [];
              if (typeof namespace === "string") {
                cal.ns[namespace] = cal.ns[namespace] || api;
                p(cal.ns[namespace], ar);
                p(cal, ["initNamespace", namespace]);
              } else p(cal, ar);
              return;
            }
            p(cal, ar);
          };
      })(window, "https://app.cal.com/embed/embed.js", "init");

      // IMPORTANTÍSIMO: estos namespaces deben coincidir con data-cal-namespace
      window.Cal("init", "salDemo", { origin: "https://cal.com" });
      window.Cal.ns["salDemo"]("ui", { theme: "dark", layout: "month_view" });

      window.Cal("init", "salMadrid", { origin: "https://cal.com" });
      window.Cal.ns["salMadrid"]("ui", { theme: "dark", layout: "month_view" });

      // Si algún CTA es <a>, evita que navegue fuera (y deja que Cal abra el modal)
      document.addEventListener("click", (e) => {
        const a = e.target.closest('a[data-cal-link]');
        if (a) e.preventDefault();
      });
    </script>
  </body>
</html>
